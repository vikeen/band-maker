{% extends 'base.html' %}

{% load widget_tweaks %}

{% block title %}Create Track{% endblock %}

{% block content %}
    <ol class="breadcrumb">
        <li><a href="{% url 'users:songs' user.username %}">My Songs</a></li>
        <li><a href="{% url 'users:song_update' user.username song.id %}">{{ song.title }}</a></li>
        <li class="active">Create Track</li>
    </ol>

    {% if form.errors %}
        <div class="alert alert-danger">Please correct the errors below:</div>
    {% endif %}

    <form action="" method="post">
        {% csrf_token %}
        <legend>Create Track</legend>
        <div class="form-group">
            <label for="id_instrument">Instrument</label>
            {% render_field form.instrument class+="form-control" required="required" %}
            {% if form.title.errors %}
                <p class="errors">{{ form.instrument.errors.as_text }}</p>
            {% endif %}
        </div>
        <div class="form-group">
            <script>
                $(document).ready(function () {
                    var $publicCheckBox = $("#id_public");

                    function publicClickHandler () {
                        var $element = $(this),
                            trackIsPublic = $element.prop("checked");

                        if (trackIsPublic) {
                            $(".js-track-upload-widget").hide();
                            $(".js-track-upload__media-url").val(undefined);
                            $(".js-track-upload__media-file-name").val(undefined);
                        } else {
                            $(".js-track-upload-widget").show();
                        }
                    }

                    publicClickHandler.bind($publicCheckBox)();
                    $publicCheckBox.on("click", publicClickHandler);
                });
            </script>
            <label for="id_public">Request Tracks {% render_field form.public %}</label>
            <span class="help-block">Allow other users to upload their work and collaborate with your song</span>
            {% if form.public.errors %}
                <p class="errors">{{ form.public.errors.as_text }}</p>
            {% endif %}
        </div>
        <div class="form-group js-track-upload-widget">
            <label for="id_track">Audio File</label>
            <div class="bm-track-upload-container"
                 data-bm-widget="track-upload"
                 data-bm-widget-track-upload-track="{{ track_json }}">
                <input type="hidden" class="js-track-upload__media-url" id="id_track_url" name="media_url"
                       value="{{ track.media_url }}" required="required"/>

                <div class="row">
                    <div class="col-xs-8 col-sm-4">
                        <input type="text" class="js-track-upload__media-file-name form-control" name="media_name"
                               required="required" readonly="readonly"
                               value="{{ track.media_name }}"/>
                    </div>
                    <div class="col-xs-4 col-sm-8">
                    <span class="btn btn-success fileinput-button">
                        <i class="glyphicon glyphicon-file"></i>&nbsp;Upload File
                        <input type="file" class="js-track-upload__media" id="id_track" name="dummy_files"
                               accept=".mp3">
                    </span>
                    </div>
                </div>
                {% if form.media_name.errors %}
                    <p class="errors">{{ form.media_name.errors.as_text }}</p>
                {% endif %}
                {% if form.media_url.errors %}
                    <p class="errors">{{ form.media_url.errors.as_text }}</p>
                {% endif %}
            </div>
        </div>
        <div class="form-group">
            <button id="submit-track" class="btn btn-primary" type="submit">Save</button>
        </div>
    </form>
{% endblock %}