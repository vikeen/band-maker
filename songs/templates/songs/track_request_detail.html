{% extends "base.html" %}
{% load gravatar %}
{% load comments %}
{% load instrument_name %}

{% block title %}{{ song.title }}{% endblock %} }}

{% block content %}
    <ol class="breadcrumb">
        <li><a href="{% url 'songs:index' %}">Songs</a></li>
        <li><a href="{% url 'songs:detail' song.pk %}">{{ song.title }}</a></li>
        <li class="active">{{ track_request.track.instrument | instrument_name }}</li>
    </ol>

    <div class="media">
        <div class="media-left">
            <a href="{% url 'users:detail' track_request.created_by %}">
                <img src="{% gravatar_url track_request.created_by.email 50 %}"
                     title="{{ track_request.created_by.username }}"/>
            </a>
        </div>
        <div class="media-body">
            <h1>Track Request
                <small>{{ track_request.track.instrument | instrument_name }}</small>
            </h1>
        </div>
    </div>

    {% include 'songs/media_player.html' with hide_actions=True hide_track_request_submit=True %}
    {% if song.created_by == request.user %}
        <div class="well">
            <form action="{% url 'songs:track_request_approve' song.pk track_request.track.pk track_request.pk %}"
                  method="post" style="display: inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-success">
                    <i class="glyphicon glyphicon-thumbs-up"></i> Approve
                </button>
            </form>
            <form action="{% url 'songs:track_request_decline' song.pk track_request.track.pk track_request.pk %}"
                  method="post" style="display: inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">
                    <i class="glyphicon glyphicon-thumbs-down"></i> Decline
                </button>
            </form>
        </div>
    {% endif %}
    <div class="comments">
        {% get_comment_count for track_request as track_request_comment_count %}
        <h3 class="comments__title">Comments ({{ track_request_comment_count }})</h3>
        {% render_comment_form for track_request %}
        {% render_comment_list for track_request %}
    </div>
{% endblock %}